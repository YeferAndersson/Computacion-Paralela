theme(legend.position = "none") +
labs(title="Mapa de calor",
subtitle=paste(yearsSelect, collapse = " - "),
caption="Datos de IGP2022")
}
#Mapa de calor 2
if(tipo == 2){
p = p + geom_density2d(data = datos3 %>%  filter(year(FECHA_UTC) %in% yearsSelect),
aes(x = LONGITUD,
y = LATITUD),
size = 0.9,
bins = 8) +
stat_density2d(data = datos3 %>%  filter(year(FECHA_UTC) %in% yearsSelect),
aes(x = LONGITUD,
y = LATITUD,
fill = ..level..,
alpha = ..level..),
geom = "polygon",
size = 0.01,
bins = 8) +
theme(legend.position = "none")+
labs(title="Mapa de calor - 2",
subtitle=paste(yearsSelect, collapse = " - "),
caption="Datos de IGP2022")
}
#Mapa de magnitudes
if(tipo == 3){
p = p + geom_point(data = datos3 %>%  filter(year(FECHA_UTC) %in% yearsSelect),
aes(x = LONGITUD,
y = LATITUD,
color = MAGNITUD,
alpha = MAGNITUD,
size = MAGNITUD))+
scale_radius(range = c(0.1,1.5))+
scale_color_viridis()+
labs(title="Magnitud de los sismos",
subtitle=paste(yearsSelect, collapse = " - "),
caption="Datos de IGP2022")
}
#Mapa de profundidades
if(tipo == 4){
p = p + geom_point(data = datos3 %>%  filter(year(FECHA_UTC) %in% yearsSelect),
aes(x = LONGITUD,
y = LATITUD,
color = PROFUNDIDAD,
alpha = PROFUNDIDAD,
size = PROFUNDIDAD))+
scale_radius(range = c(0.1,1.5))+
scale_color_viridis()+
labs(title="Profundidad de los sismos",
subtitle=paste(yearsSelect, collapse = " - "),
caption="Datos de IGP2022")
}
p = p + theme_bw()
return(ggplotly(p))
#return(p)
}
p_nacional(1, year_test)
p_nacional <- function(tipo, yearsSelect){
p = ggplot(data = peru_d) +
geom_sf()
#Mapa de calor 1
if(tipo == 1){
p = p + stat_density2d(data = datos3 %>%  filter(year(FECHA_UTC) %in% yearsSelect),
aes(x = LONGITUD ,
y = LATITUD,
fill = ..level..,
alpha = ..level..),
geom = "polygon",
size = 0.01,
bins = 8) +
scale_fill_gradient(low = "yellow",
high = "red") +
scale_alpha(range = c(0.2, 0.7)) +
theme(legend.position = "none") +
labs(title="Mapa de calor",
subtitle=paste(yearsSelect, collapse = " - "),
caption="Datos de IGP2022")
}
#Mapa de calor 2
if(tipo == 2){
p = p + geom_density2d(data = datos3 %>%  filter(year(FECHA_UTC) %in% yearsSelect),
aes(x = LONGITUD,
y = LATITUD),
size = 0.9,
bins = 8) +
stat_density2d(data = datos3 %>%  filter(year(FECHA_UTC) %in% yearsSelect),
aes(x = LONGITUD,
y = LATITUD,
fill = ..level..,
alpha = ..level..),
geom = "polygon",
size = 0.01,
bins = 8) +
theme(legend.position = "none")+
labs(title="Mapa de calor - 2",
subtitle=paste(yearsSelect, collapse = " - "),
caption="Datos de IGP2022")
}
#Mapa de magnitudes
if(tipo == 3){
p = p + geom_point(data = datos3 %>%  filter(year(FECHA_UTC) %in% yearsSelect),
aes(x = LONGITUD,
y = LATITUD,
color = MAGNITUD,
alpha = MAGNITUD,
size = MAGNITUD))+
scale_radius(range = c(0.1,1.5))+
scale_color_viridis()+
labs(title="Magnitud de los sismos",
subtitle=paste(yearsSelect, collapse = " - "),
caption="Datos de IGP2022")
}
#Mapa de profundidades
if(tipo == 4){
p = p + geom_point(data = datos3 %>%  filter(year(FECHA_UTC) %in% yearsSelect),
aes(x = LONGITUD,
y = LATITUD,
color = PROFUNDIDAD,
alpha = PROFUNDIDAD,
size = PROFUNDIDAD))+
scale_radius(range = c(0.1,1.5))+
scale_color_viridis()+
labs(title="Profundidad de los sismos",
subtitle=paste(yearsSelect, collapse = " - "),
caption="Datos de IGP2022")
}
p = p + theme_dark()
return(ggplotly(p))
#return(p)
}
p_nacional(3, 1960:2021)
p_nacional <- function(tipo, yearsSelect){
p = ggplot(data = peru_d) +
geom_sf()
#Mapa de calor 1
if(tipo == 1){
p = p + stat_density2d(data = datos3 %>%  filter(year(FECHA_UTC) %in% yearsSelect),
aes(x = LONGITUD ,
y = LATITUD,
fill = ..level..,
alpha = ..level..),
geom = "polygon",
size = 0.01,
bins = 8) +
scale_fill_gradient(low = "yellow",
high = "red") +
scale_alpha(range = c(0.2, 0.7)) +
theme(legend.position = "none") +
labs(title="Mapa de calor",
subtitle=paste(yearsSelect, collapse = " - "),
caption="Datos de IGP2022")
}
#Mapa de calor 2
if(tipo == 2){
p = p + geom_density2d(data = datos3 %>%  filter(year(FECHA_UTC) %in% yearsSelect),
aes(x = LONGITUD,
y = LATITUD),
size = 0.9,
bins = 8) +
stat_density2d(data = datos3 %>%  filter(year(FECHA_UTC) %in% yearsSelect),
aes(x = LONGITUD,
y = LATITUD,
fill = ..level..,
alpha = ..level..),
geom = "polygon",
size = 0.01,
bins = 8) +
theme(legend.position = "none")+
labs(title="Mapa de calor - 2",
subtitle=paste(yearsSelect, collapse = " - "),
caption="Datos de IGP2022")
}
#Mapa de magnitudes
if(tipo == 3){
p = p + geom_point(data = datos3 %>%  filter(year(FECHA_UTC) %in% yearsSelect),
aes(x = LONGITUD,
y = LATITUD,
color = MAGNITUD,
alpha = MAGNITUD,
size = MAGNITUD))+
scale_radius(range = c(0.1,1.5))+
scale_color_viridis()+
labs(title="Magnitud de los sismos",
subtitle=paste(yearsSelect, collapse = " - "),
caption="Datos de IGP2022")
}
#Mapa de profundidades
if(tipo == 4){
p = p + geom_point(data = datos3 %>%  filter(year(FECHA_UTC) %in% yearsSelect),
aes(x = LONGITUD,
y = LATITUD,
color = PROFUNDIDAD,
alpha = PROFUNDIDAD,
size = PROFUNDIDAD))+
scale_radius(range = c(0.1,1.5))+
scale_color_viridis()+
labs(title="Profundidad de los sismos",
subtitle=paste(yearsSelect, collapse = " - "),
caption="Datos de IGP2022")
}
p = p + theme_minimal()
return(ggplotly(p))
#return(p)
}
p_nacional(3, 1960:2021)
p_nacional <- function(tipo, yearsSelect){
p = ggplot(data = peru_d) +
geom_sf()
#Mapa de calor 1
if(tipo == 1){
p = p + stat_density2d(data = datos3 %>%  filter(year(FECHA_UTC) %in% yearsSelect),
aes(x = LONGITUD ,
y = LATITUD,
fill = ..level..,
alpha = ..level..),
geom = "polygon",
size = 0.01,
bins = 8) +
scale_fill_gradient(low = "yellow",
high = "red") +
scale_alpha(range = c(0.2, 0.7)) +
theme(legend.position = "none") +
labs(title="Mapa de calor",
subtitle=paste(yearsSelect, collapse = " - "),
caption="Datos de IGP2022")
}
#Mapa de calor 2
if(tipo == 2){
p = p + geom_density2d(data = datos3 %>%  filter(year(FECHA_UTC) %in% yearsSelect),
aes(x = LONGITUD,
y = LATITUD),
size = 0.9,
bins = 8) +
stat_density2d(data = datos3 %>%  filter(year(FECHA_UTC) %in% yearsSelect),
aes(x = LONGITUD,
y = LATITUD,
fill = ..level..,
alpha = ..level..),
geom = "polygon",
size = 0.01,
bins = 8) +
theme(legend.position = "none")+
labs(title="Mapa de calor - 2",
subtitle=paste(yearsSelect, collapse = " - "),
caption="Datos de IGP2022")
}
#Mapa de magnitudes
if(tipo == 3){
p = p + geom_point(data = datos3 %>%  filter(year(FECHA_UTC) %in% yearsSelect),
aes(x = LONGITUD,
y = LATITUD,
color = MAGNITUD,
alpha = MAGNITUD,
size = MAGNITUD))+
scale_radius(range = c(0.1,1.5))+
scale_color_viridis()+
labs(title="Magnitud de los sismos",
subtitle=paste(yearsSelect, collapse = " - "),
caption="Datos de IGP2022")
}
#Mapa de profundidades
if(tipo == 4){
p = p + geom_point(data = datos3 %>%  filter(year(FECHA_UTC) %in% yearsSelect),
aes(x = LONGITUD,
y = LATITUD,
color = PROFUNDIDAD,
alpha = PROFUNDIDAD,
size = PROFUNDIDAD))+
scale_radius(range = c(0.1,1.5))+
scale_color_viridis()+
labs(title="Profundidad de los sismos",
subtitle=paste(yearsSelect, collapse = " - "),
caption="Datos de IGP2022")
}
p = p + theme_bw()
return(ggplotly(p))
#return(p)
}
p_nacional(1, year_test)
p_nacional(4, 1960:2021)
p_nacional(3, 1960:2021)
p_nacional <- function(tipo, yearsSelect){
p = ggplot(data = peru_d) +
geom_sf()
#Mapa de calor 1
if(tipo == 1){
p = p + stat_density2d(data = datos3 %>%  filter(year(FECHA_UTC) %in% yearsSelect),
aes(x = LONGITUD ,
y = LATITUD,
fill = ..level..,
alpha = ..level..),
geom = "polygon",
size = 0.01,
bins = 8) +
scale_fill_gradient(low = "yellow",
high = "red") +
scale_alpha(range = c(0.2, 0.7)) +
theme(legend.position = "none") +
labs(title="Mapa de calor",
subtitle=paste(yearsSelect, collapse = " - "),
caption="Datos de IGP2022")
}
#Mapa de calor 2
if(tipo == 2){
p = p + geom_density2d(data = datos3 %>%  filter(year(FECHA_UTC) %in% yearsSelect),
aes(x = LONGITUD,
y = LATITUD),
size = 0.9,
bins = 8) +
stat_density2d(data = datos3 %>%  filter(year(FECHA_UTC) %in% yearsSelect),
aes(x = LONGITUD,
y = LATITUD,
fill = ..level..,
alpha = ..level..),
geom = "polygon",
size = 0.01,
bins = 8) +
theme(legend.position = "none")+
labs(title="Mapa de calor - 2",
subtitle=paste(yearsSelect, collapse = " - "),
caption="Datos de IGP2022")
}
#Mapa de magnitudes
if(tipo == 3){
p = p + geom_point(data = datos3 %>%  filter(year(FECHA_UTC) %in% yearsSelect),
aes(x = LONGITUD,
y = LATITUD,
color = MAGNITUD,
alpha = MAGNITUD,
size = MAGNITUD))+
scale_radius(range = c(0.1,1.5))+
scale_color_viridis()+
labs(title="Magnitud de los sismos",
subtitle=paste(yearsSelect, collapse = " - "),
caption="Datos de IGP2022")
}
#Mapa de profundidades
if(tipo == 4){
p = p + geom_point(data = datos3 %>%  filter(year(FECHA_UTC) %in% yearsSelect),
aes(x = LONGITUD,
y = LATITUD,
color = PROFUNDIDAD,
alpha = PROFUNDIDAD,
size = PROFUNDIDAD))+
scale_radius(range = c(0.1,1.5))+
scale_color_viridis()+
labs(title="Profundidad de los sismos",
subtitle=paste(yearsSelect, collapse = " - "),
caption="Datos de IGP2022")
}
p = p + theme_bw()
#return(ggplotly(p))
return(p)
}
p_nacional(3, 1960:2021)
p_nacional <- function(tipo, yearsSelect){
p = ggplot(data = peru_d) +
geom_sf()
#Mapa de calor 1
if(tipo == 1){
p = p + stat_density2d(data = datos3 %>%  filter(year(FECHA_UTC) %in% yearsSelect),
aes(x = LONGITUD ,
y = LATITUD,
fill = ..level..,
alpha = ..level..),
geom = "polygon",
size = 0.01,
bins = 8) +
scale_fill_gradient(low = "yellow",
high = "red") +
scale_alpha(range = c(0.2, 0.7)) +
theme(legend.position = "none") +
labs(title="Mapa de calor",
subtitle=paste(yearsSelect, collapse = " - "),
caption="Datos de IGP2022")
}
#Mapa de calor 2
if(tipo == 2){
p = p + geom_density2d(data = datos3 %>%  filter(year(FECHA_UTC) %in% yearsSelect),
aes(x = LONGITUD,
y = LATITUD),
size = 0.9,
bins = 8) +
stat_density2d(data = datos3 %>%  filter(year(FECHA_UTC) %in% yearsSelect),
aes(x = LONGITUD,
y = LATITUD,
fill = ..level..,
alpha = ..level..),
geom = "polygon",
size = 0.01,
bins = 8) +
theme(legend.position = "none")+
labs(title="Mapa de calor - 2",
subtitle=paste(yearsSelect, collapse = " - "),
caption="Datos de IGP2022")
}
#Mapa de magnitudes
if(tipo == 3){
p = p + geom_point(data = datos3 %>%  filter(year(FECHA_UTC) %in% yearsSelect),
aes(x = LONGITUD,
y = LATITUD,
color = MAGNITUD,
alpha = MAGNITUD,
size = MAGNITUD))+
scale_radius(range = c(0.1,1.5))+
scale_color_viridis()+
labs(title="Magnitud de los sismos",
subtitle=paste(yearsSelect, collapse = " - "),
caption="Datos de IGP2022")
}
#Mapa de profundidades
if(tipo == 4){
p = p + geom_point(data = datos3 %>%  filter(year(FECHA_UTC) %in% yearsSelect),
aes(x = LONGITUD,
y = LATITUD,
color = PROFUNDIDAD,
alpha = PROFUNDIDAD,
size = PROFUNDIDAD))+
scale_radius(range = c(0.1,1.5))+
scale_color_viridis()+
labs(title="Profundidad de los sismos",
subtitle=paste(yearsSelect, collapse = " - "),
caption="Datos de IGP2022")
}
p = p + theme_bw()
return(ggplotly(p))
#return(p)
}
p_nacional(3, 1960:2021)
shiny::runApp('ObservatorioSismico')
runApp('ObservatorioSismico')
p_nacional <- function(tipo, yearsSelect = 1960:2021){
p = ggplot(data = peru_d) +
geom_sf()
#Mapa de calor 1
if(tipo == 1){
p = p + stat_density2d(data = datos3 %>%  filter(year(FECHA_UTC) %in% yearsSelect),
aes(x = LONGITUD ,
y = LATITUD,
fill = ..level..,
alpha = ..level..),
geom = "polygon",
size = 0.01,
bins = 8) +
scale_fill_gradient(low = "yellow",
high = "red") +
scale_alpha(range = c(0.2, 0.7)) +
theme(legend.position = "none") +
labs(title="Mapa de calor",
subtitle=paste(yearsSelect, collapse = " - "),
caption="Datos de IGP2022")
}
#Mapa de calor 2
if(tipo == 2){
p = p + geom_density2d(data = datos3 %>%  filter(year(FECHA_UTC) %in% yearsSelect),
aes(x = LONGITUD,
y = LATITUD),
size = 0.9,
bins = 8) +
stat_density2d(data = datos3 %>%  filter(year(FECHA_UTC) %in% yearsSelect),
aes(x = LONGITUD,
y = LATITUD,
fill = ..level..,
alpha = ..level..),
geom = "polygon",
size = 0.01,
bins = 8) +
theme(legend.position = "none")+
labs(title="Mapa de calor - 2",
subtitle=paste(yearsSelect, collapse = " - "),
caption="Datos de IGP2022")
}
#Mapa de magnitudes
if(tipo == 3){
p = p + geom_point(data = datos3 %>%  filter(year(FECHA_UTC) %in% yearsSelect),
aes(x = LONGITUD,
y = LATITUD,
color = MAGNITUD,
alpha = MAGNITUD,
size = MAGNITUD))+
scale_radius(range = c(0.1,1.5))+
scale_color_viridis()+
labs(title="Magnitud de los sismos",
subtitle=paste(yearsSelect, collapse = " - "),
caption="Datos de IGP2022")
}
#Mapa de profundidades
if(tipo == 4){
p = p + geom_point(data = datos3 %>%  filter(year(FECHA_UTC) %in% yearsSelect),
aes(x = LONGITUD,
y = LATITUD,
color = PROFUNDIDAD,
alpha = PROFUNDIDAD,
size = PROFUNDIDAD))+
scale_radius(range = c(0.1,1.5))+
scale_color_viridis()+
labs(title="Profundidad de los sismos",
subtitle=paste(yearsSelect, collapse = " - "),
caption="Datos de IGP2022")
}
p = p + theme_bw()
return(ggplotly(p))
#return(p)
}
runApp('ObservatorioSismico')
runApp('ObservatorioSismico')
runApp('ObservatorioSismico')
runApp('ObservatorioSismico')
runApp('ObservatorioSismico')
runApp('ObservatorioSismico')
runApp('ObservatorioSismico')
